---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - command: echo "=== REDIS POD RESOURCES (after webhook) ==="
  - command: kubectl get pod -n test-webhook -l app=redis -o jsonpath='{range .items[*]}{.metadata.name}{" CPU:"}{.spec.containers[0].resources.requests.cpu}{" Memory:"}{.spec.containers[0].resources.requests.memory}{" Limit:"}{.spec.containers[0].resources.limits.memory}{"\n"}{end}'
  - command: echo ""
  - command: echo "=== MEMCACHED POD RESOURCES (after webhook) ==="
  - command: kubectl get pod -n test-webhook -l app=memcached -o jsonpath='{range .items[*]}{.metadata.name}{" CPU:"}{.spec.containers[0].resources.requests.cpu}{" Memory:"}{.spec.containers[0].resources.requests.memory}{" Limit:"}{.spec.containers[0].resources.limits.memory}{"\n"}{end}'
  - command: echo ""
  - command: echo "=== WEBHOOK LOGS ==="
  - command: kubectl logs -n cruisekube-system deploy/cruisekube-webhook --tail=20
