---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  - command: echo "=== RECORDING CURRENT POD NAMES AND RESOURCES ==="
  - command: kubectl get pods -n test-webhook -l app=redis -o jsonpath='{range .items[*]}{.metadata.name}{" UID:"}{.metadata.uid}{" CPU:"}{.spec.containers[0].resources.requests.cpu}{" Memory:"}{.spec.containers[0].resources.requests.memory}{"\n"}{end}'
  - command: kubectl get pods -n test-webhook -l app=memcached -o jsonpath='{range .items[*]}{.metadata.name}{" UID:"}{.metadata.uid}{" CPU:"}{.spec.containers[0].resources.requests.cpu}{" Memory:"}{.spec.containers[0].resources.requests.memory}{"\n"}{end}'
  - command: echo ""
  - command: echo "=== DELETING PODS TO TRIGGER RECREATION ==="
  - command: kubectl delete pod -n test-webhook -l app=redis --wait=false
  - command: kubectl delete pod -n test-webhook -l app=memcached --wait=false
  - command: echo "Pods deleted"
